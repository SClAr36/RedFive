<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebSocket å®¢æˆ·ç«¯</title>
    <!-- æ ·å¼æ”¾åœ¨è¿™é‡Œ -->
    <style>
      #hand button.card-button {
        margin: 5px;
        padding: 10px;
        font-size: 18px;
        border: 1px solid #999;
        border-radius: 5px;
        cursor: pointer;
      }
  
      #hand button.card-button.selected {
        background-color: #ffd;
        border: 2px solid red;
      }
    </style> 
</head>
<body>
  <h2>çº¢äº”å†²å†²å†²</h2>
  <button onclick="dealCards()">å‘ç‰Œ</button>  
  <button onclick="Ready()">å‡†å¤‡</button>
  <input type="text" id="message" placeholder="è¾“å…¥æ¶ˆæ¯æˆ–ç‰Œç»„">
  <button onclick="sendMessage()">å‘é€æ¶ˆæ¯</button>
  <button onclick="ws.close()">å…³é—­è¿æ¥</button>
  <div>
    <h3>ä½ çš„æ‰‹ç‰Œæ˜¯ï¼š</h3>
    <div id="hand"></div>             <!-- æ”¾ç½®æ‰‹ç‰ŒæŒ‰é’® -->
    <button onclick="sendPlay()">å‡ºç‰Œ</button>
  </div>
  <pre id="log"></pre>

  <script>
    const handDiv = document.getElementById("hand");
    const log = document.getElementById('log');
    const ws = new WebSocket("ws://localhost:8765");    
    
    ws.onopen = () => log.textContent += "âœ… å·²è¿æ¥æœåŠ¡å™¨\n";    
    ws.onclose = () => log.textContent += "ğŸ”Œ è¿æ¥å…³é—­\n";

    let hand = [];

    ws.onmessage = (e) => {
      try {
        const data = JSON.parse(e.data);
    
        switch (data.type) {
          case "welcome":
            log.textContent = `æ¬¢è¿åŠ å…¥æˆ¿é—´ ${data.room_id}ï¼Œ${data.player_id}ï¼Œä½ æ˜¯ç©å®¶ ${data.player_number}\n`;
            break;
    
          case "player_join":
            log.textContent += `ğŸ‘¤ ç©å®¶${data.player_id} (ç©å®¶ ${data.player_number} ) åŠ å…¥äº†æˆ¿é—´ ${data.room_id}\n`;
            break;

          case "chat":
            log.textContent += `ğŸ’¬ ç©å®¶${data.player_number}ï¼š${data.content}\n`;
            break;
    
          case "ready_status":
            log.textContent += `ğŸƒ ç©å®¶${data.player_number} å‡†å¤‡å¥½äº†\n`;
            break;
    
          case "deal_start":
            log.textContent += `ğŸ² å¼€å§‹å‘ç‰Œï¼\n`;
            break;
    
          case "deal_done":
            log.textContent += `âœ… æˆ¿é—´ ${data.room_id}å‘ç‰Œå®Œæˆï¼\n`;
            break;
    
          case "your_hand":
            hand = data.hand;
            log.textContent += `ğŸƒ ä½ çš„æ‰‹ç‰Œæ›´æ–°ï¼ˆ${hand.length} å¼ ï¼‰\n`;
            updateHandDisplay();
            break;
    
          case "play_card":
            log.textContent += `ğŸ•¹ï¸ ç©å®¶${data.player_number} å‡ºäº†ç‰Œï¼š${data.cards.join(", ")}\n`;
            break;
    
          case "error":
            alert("âš ï¸ é”™è¯¯ï¼š" + data.message);
            break;
    
          case "player_leave":
            log.textContent += `ğŸ‘‹ ç©å®¶${data.player_number} ç¦»å¼€äº†æˆ¿é—´ ${data.room_id}\n`;
            break;
    
          default:
            log.textContent += `ğŸ“© æ”¶åˆ°æœªçŸ¥ç±»å‹æ¶ˆæ¯: ${e.data}\n`;
        }
    
      } catch {
        log.textContent += "ğŸ“© é JSON æ¶ˆæ¯: " + e.data + "\n";
      }
    };
    

    function sendMessage() {
      const message = document.getElementById('message').value;
      ws.send(JSON.stringify({
        type: "message",
        content: message
      }));
      log.textContent += "ğŸ“© ä½ è¯´: " + message + "\n";
    }
    function Ready() {
      ws.send(JSON.stringify({
        type: "ready"
      }));
      log.textContent += "ğŸƒ ä½ å‡†å¤‡å¥½äº†\n";
    }
    function dealCards(){
      ws.send(JSON.stringify({
        type: "deal_cards"
      }));
    }
    
    function updateHandDisplay() {
      handDiv.innerHTML = "";  // æ¸…ç©ºæ—§çš„æ‰‹ç‰Œæ˜¾ç¤º
    
      hand.forEach(card => {
        const btn = document.createElement("button");
        btn.textContent = card;
        btn.classList.add("card-button");
        btn.onclick = () => {
          btn.classList.toggle("selected");
        };
        handDiv.appendChild(btn);
      });
    }
    function sendPlay() {
      const selectedCards = [
        ...handDiv.querySelectorAll("button.card-button.selected")
      ].map(btn => btn.textContent);
    
      if (selectedCards.length === 0) {
        alert("è¯·å…ˆé€‰æ‹©è¦å‡ºçš„ç‰Œï¼");
        return;
      }
    
      ws.send(JSON.stringify({
        type: "play_card",
        cards: selectedCards
      }));
    }

  </script>
</body>
</html>
