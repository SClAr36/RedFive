<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>çº¢äº”å†²å†²å†² - WebSocket å®¢æˆ·ç«¯</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    
    h2 {
      color: #d32f2f;
      text-align: center;
      margin-bottom: 20px;
      font-size: 28px;
    }
    
    #room-status {
      background-color: #fff;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-weight: bold;
      color: #d32f2f;
      text-align: center;
      min-height: 20px;
    }
    
    .control-panel {
      background-color: #fff;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .input-group {
      margin-bottom: 10px;
      display: flex;
      gap: 10px;
    }
    
    input[type="text"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      flex-grow: 1;
    }
    
    button {
      padding: 8px 15px;
      background-color: #d32f2f;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #b71c1c;
    }
    
    .card-area {
      background-color: #fff;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #hand {
      position: relative;
      min-height: 150px;
      margin: 15px 0;
    }
    
    .card-container {
      position: relative;
      width: 100%;
      margin-bottom: 20px;
    }
    
    .card-row {
      display: flex;
      justify-content: center;
      width: 100%;
      position: relative;  /* æ·»åŠ ç›¸å¯¹å®šä½ */
    }
    
    .card-row:nth-child(2) {
      top: 1px;  /* ç¬¬äºŒæ’ä¸‹ç§»60pxï¼ˆ120pxé«˜åº¦çš„ä¸€åŠï¼‰ */
      margin-left: 1px;  /* å‘å³åç§»40pxè®©ç‰Œé”™å¼€ */
    }
    
    .card {
      position: relative;
      width: 80px;
      height: 120px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      transition: all 0.3s ease;
      cursor: pointer;
      user-select: none;
      transform-origin: center bottom;
      border: 2px solid #ddd;
      margin-right: -50px;
    }
    
    .card-rank, .card-suit {
      position: absolute;
      left: 5px;  /* è·ç¦»å·¦ä¾§5px */
    }
    
    .card-rank {
      top: 5px;  /* ç‚¹æ•°åœ¨ä¸Š */
    }
    
    .card-suit {
      top: 30px;  /* èŠ±è‰²åœ¨ä¸‹ï¼Œä¸ç‚¹æ•°ä¿æŒé—´è· */
    }
    
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    
    .card.selected {
      transform: translateY(-30px);
      border: 2px solid #d32f2f;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      z-index: 10;
    }
    
    .card[data-suit="â™¥"] .card-rank,
    .card[data-suit="â™¥"] .card-suit,
    .card[data-suit="â™¦"] .card-rank,
    .card[data-suit="â™¦"] .card-suit {
      color: #d32f2f;
    }
    
    .card[data-suit="â™ "] .card-rank,
    .card[data-suit="â™ "] .card-suit,
    .card[data-suit="â™£"] .card-rank,
    .card[data-suit="â™£"] .card-suit {
      color: #333;
    }
    
    #hidden {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }
    
    #hidden span {
      display: inline-block;
      padding: 12px;
      font-size: 18px;
      border: 2px solid #ddd;
      border-radius: 8px;
      min-width: 50px;
      text-align: center;
      background-color: #f5f5f5;
    }
    
    #log {
      background-color: #333;
      color: #fff;
      padding: 15px;
      border-radius: 5px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      position: relative;
      z-index: 20;
    }
    
    .section-title {
      color: #d32f2f;
      margin-bottom: 10px;
      font-size: 18px;
    }
    
    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .game-prepare {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
  </style> 
</head>
<body>
  <h2>çº¢äº”å†²å†²å†²</h2> 
  <div id="room-status">ğŸ² æ¬¢è¿åŠ å…¥çº¢äº”å†²å†²å†²æ¸¸æˆï¼è¯·è®¾ç½®æ˜µç§°å¹¶å‡†å¤‡</div>
  
  <div class="control-panel">
    <div class="input-group">
      <input type="text" id="nicknameInput" placeholder="è¾“å…¥æ˜µç§°">
      <button onclick="setNickname()">è®¾ç½®æ˜µç§°</button>
    </div>
    
    <div class="input-group">
      <input type="text" id="message" placeholder="è¾“å…¥èŠå¤©æ¶ˆæ¯">
      <button onclick="sendMessage()">å‘é€</button>
    </div>
  </div>
  
  <div class="card-area">
    <div class="game-prepare">
      <button onclick="Ready()">å‡†å¤‡</button>
      <button onclick="promptTrump()">å‘ç‰Œ</button>
    </div>
    
    <h3 class="section-title">ä½ çš„æ‰‹ç‰Œï¼š</h3>
    <div id="hand">
      <div class="card-container" id="card-container"></div>
    </div>
    
    <div class="action-buttons">
      <button onclick="sendPlay()">å‡ºç‰Œ</button>
      <button onclick="hideCards()">è—ç‰Œ</button>
    </div>
    
    <h3 class="section-title">ä½ çš„åº•ç‰Œï¼š</h3>
    <div id="hidden"></div>
  </div>
  
  <div class="log-header">
    <h3 class="section-title">æ¸¸æˆæ—¥å¿—ï¼š</h3>
    <button onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
  </div>
  <pre id="log"></pre>

  <script>
    const handDiv = document.getElementById("card-container");
    const log = document.getElementById('log');
    const roomStatus = document.getElementById("room-status");
    const ws = new WebSocket("ws://localhost:8765");    
    
    // åˆå§‹åŒ–æˆ¿é—´çŠ¶æ€
    roomStatus.textContent = "ğŸ² æ¬¢è¿åŠ å…¥çº¢äº”å†²å†²å†²æ¸¸æˆï¼è¯·è®¾ç½®æ˜µç§°å¹¶å‡†å¤‡";
    
    ws.onopen = () => {
      log.textContent += "âœ… å·²è¿æ¥æœåŠ¡å™¨\n";
    };    
    ws.onclose = () => log.textContent += "ğŸ”Œ è¿æ¥å…³é—­\n";

    let hand = [];

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
    
        switch (data.type) {
          case "welcome":
            log.textContent = `æ¬¢è¿åŠ å…¥æˆ¿é—´ ${data.room_id}ï¼Œ${data.player_id}ï¼Œä½ æ˜¯ç©å®¶ ${data.player_number}\n`;
            roomStatus.textContent = `ğŸ‘‹ æ¬¢è¿åŠ å…¥æˆ¿é—´ ${data.room_id}ï¼Œä½ æ˜¯ç©å®¶ ${data.player_number}`;
            break;
    
          case "player_join":
            log.textContent += `ğŸ‘¤ ç©å®¶${data.player_id} (ç©å®¶${data.player_number}) åŠ å…¥äº†æˆ¿é—´ ${data.room_id}\n`;
            break;
          
          case "nickname_set":
            log.textContent += `ğŸ“› ç©å®¶${data.player_id} (ç©å®¶${data.player_number}) è®¾ç½®æ˜µç§°ä¸º ${data.nickname}\n`;
            break;
          
          case "chat":
            log.textContent += `ğŸ’¬ ${data.player_name}ï¼š${data.content}\n`;
            break;
    
          case "ready_status":
            log.textContent += `ğŸƒ ${data.player_name} å‡†å¤‡å¥½äº†\n`;
            roomStatus.textContent = `ğŸƒ ${data.player_name} å·²å‡†å¤‡ï¼Œç­‰å¾…å‘ç‰Œ...`;
            break;
            
          case "deal_start":
            const rank = data.rank_input;
            const suit = data.suit_input;
            roomStatus.textContent = `ğŸ¯ æœ¬è½®ä¸»æ•°ï¼š${rank}ï¼Œä¸»èŠ±è‰²ï¼š${suit}`;
            log.textContent += `ğŸ² å¼€å§‹å‘ç‰Œï¼ä¸»æ•°æ˜¯ ${rank}ï¼Œä¸»èŠ±è‰²æ˜¯ ${suit}\n`;
            break;
    
          case "deal_done":
            log.textContent += `âœ… æˆ¿é—´ ${data.room_id}å‘ç‰Œå®Œæˆï¼\n`;
            break;
    
          case "your_hand":
            hand = data.hand;
            log.textContent += `ğŸƒ ä½ çš„æ‰‹ç‰Œæ›´æ–°ï¼ˆ${hand.length} å¼ ï¼‰\n`;
            updateHandDisplay();
            break;
          
          case "your_hidden":
            const hiddenDiv = document.getElementById("hidden");
            hiddenDiv.innerHTML = "";
            data.cards.forEach(card => {
              const el = document.createElement("span");
              el.textContent = card + " ";
              hiddenDiv.appendChild(el);
            });
            break;

          case "play_card":
            log.textContent += `ğŸ•¹ï¸ ${data.player_name} å‡ºäº†ç‰Œï¼š${data.cards.join(", ")}\n`;
            break;
    
          case "error":
            alert("âš ï¸ é”™è¯¯ï¼š" + data.message);
            break;
    
          case "player_leave":
            log.textContent += `ğŸ‘‹ ${data.player_name} ç¦»å¼€äº†æˆ¿é—´ ${data.room_id}\n`;
            break;
    
          default:
            log.textContent += `ğŸ“© æ”¶åˆ°æœªçŸ¥ç±»å‹æ¶ˆæ¯: ${event.data}\n`;
        }
    
      } catch (e) {
        log.textContent += "ğŸ“© é JSON æ¶ˆæ¯: " + e.data + "\n";
      }
    };
    
    function setNickname() {
      const nickname = document.getElementById("nicknameInput").value.trim();
      if (nickname) {
        ws.send(JSON.stringify({
          type: "set_nickname",
          nickname: nickname
        }));
        log.textContent += `ğŸ“› ä½ è®¾ç½®çš„æ˜µç§°æ˜¯ï¼š${nickname}\n`;
        document.getElementById('nicknameInput').value = "";
        roomStatus.textContent = `ğŸ“› æ¬¢è¿ï¼Œ${nickname}ï¼è¯·ç‚¹å‡»"å‡†å¤‡"æŒ‰é’®`;
      }
    }    
    
    function clearLog() {
      log.textContent = "";
    }
    
    function sendMessage() {
      const message = document.getElementById('message').value;
      ws.send(JSON.stringify({
        type: "message",
        content: message
      }));
      log.textContent += "ğŸ“© ä½ è¯´: " + message + "\n";
      document.getElementById('message').value = "";
    }
    
    function Ready() {
      ws.send(JSON.stringify({
        type: "ready"
      }));
      log.textContent += "ğŸƒ ä½ å‡†å¤‡å¥½äº†\n";
      roomStatus.textContent = "ğŸƒ å·²å‡†å¤‡ï¼Œç­‰å¾…å…¶ä»–ç©å®¶...";
    }
    
    function dealCards(){
      ws.send(JSON.stringify({
        type: "deal_cards"
      }));
    }
    
    function updateHandDisplay() {
      handDiv.innerHTML = "";
      
      const row1 = document.createElement("div");
      row1.className = "card-row";
      const row2 = document.createElement("div");
      row2.className = "card-row";
      
      const half = Math.ceil(hand.length / 2);
      const firstRowCards = hand.slice(0, half);
      const secondRowCards = hand.slice(half);
      
      firstRowCards.forEach((card, index) => {
        const cardEl = createCardElement(card, index);
        row1.appendChild(cardEl);
      });
      
      secondRowCards.forEach((card, index) => {
        const cardEl = createCardElement(card, index);
        row2.appendChild(cardEl);
      });
      
      handDiv.appendChild(row1);
      handDiv.appendChild(row2);
    }
    
    function createCardElement(card, index) {
      const cardEl = document.createElement("div");
      cardEl.className = "card";
      
      const rank = card.slice(0, -1);
      const suit = card.slice(-1);
      
      const rankEl = document.createElement("div");
      rankEl.className = "card-rank";
      rankEl.textContent = rank;
      
      const suitEl = document.createElement("div");
      suitEl.className = "card-suit";
      suitEl.textContent = suit;
      
      cardEl.appendChild(rankEl);
      cardEl.appendChild(suitEl);
      
      if (['â™¥', 'â™¦', 'â™ ', 'â™£'].includes(suit)) {
        cardEl.setAttribute('data-suit', suit);
      }
      
      cardEl.style.zIndex = index;
      
      cardEl.onclick = () => {
        cardEl.classList.toggle("selected");
      };
      
      return cardEl;
    }
    
    function sendPlay() {
      const selectedCards = [];
      document.querySelectorAll(".card.selected").forEach(card => {
        const rank = card.querySelector(".card-rank").textContent;
        const suit = card.querySelector(".card-suit").textContent;
        selectedCards.push(rank + suit);
      });
    
      if (selectedCards.length === 0) {
        alert("è¯·å…ˆé€‰æ‹©è¦å‡ºçš„ç‰Œï¼");
        return;
      }
    
      ws.send(JSON.stringify({
        type: "play_card",
        cards: selectedCards
      }));
      
      document.querySelectorAll(".card.selected").forEach(card => {
        card.classList.remove("selected");
      });
    }
    
    function hideCards() {
      const selectedCards = [];
      document.querySelectorAll(".card.selected").forEach(card => {
        const rank = card.querySelector(".card-rank").textContent;
        const suit = card.querySelector(".card-suit").textContent;
        selectedCards.push(rank + suit);
      });
    
      if (selectedCards.length !== 8) {
        alert("è¯·é€‰æ‹©æ°å¥½ 8 å¼ ç‰Œä½œä¸ºåº•ç‰Œï¼");
        return;
      }
    
      ws.send(JSON.stringify({
        type: "hide_cards",
        cards: selectedCards
      }));
      
      document.querySelectorAll(".card.selected").forEach(card => {
        card.classList.remove("selected");
      });
    }
    
    function promptTrump() {
      const rank = prompt("è¯·é€‰æ‹©æœ¬å±€çš„ä¸»æ•°ï¼ˆä¾‹å¦‚ 2~Aï¼‰");
      if (!rank || !["2","4","6","7","8","9","10","J","Q","K","A"].includes(rank)) {
        alert("æ— æ•ˆä¸»æ•°ï¼");
        return;
      }
    
      const suits = ["â™ ", "â™¥", "â™£", "â™¦"];
      const suit = suits[Math.floor(Math.random() * 4)];
      alert("ç³»ç»ŸéšæœºæŠ½å–çš„ä¸»èŠ±è‰²æ˜¯ï¼š" + suit);
    
      ws.send(JSON.stringify({
        type: "deal_cards",
        rank_input: rank,
        suit_input: suit
      }));
    }
  </script>
</body>
</html>